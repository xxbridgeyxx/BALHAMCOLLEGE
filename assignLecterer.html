<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Assign Lecturer</title>
    <style type="text/css">
        button {
            width: 20%;
            height: 10%;
        }
        body{
            font-family: "Arial";
        }

        .center{
            margin: auto;
            width: 60%;
            border: 3px solid #73AD21;
            padding: 10px;
        }

        h1{
            text-align: center;
        }

        label{
            text-align: right;
            width: 140px;
            display: block;
            float: left;
            clear: left;
            margin-right: 3px;
            cursor: pointer;
        }
    </style>

    <script
            src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous">
    </script>
    <script>
        function getLecturerInfo (lecturer_id) {
            $.ajax({
                type: 'Get',
                dataType: 'JSON',
                async:false,
                url: 'https://balham-college-db.herokuapp.com/api/Lecturer/'+lecturer_id,
                success: function (data) {
                    // location.reload();
                    lecturer = data;
                },

                error: function (err) {
                    console.log(err);
                }
            });
            return lecturer;
        }

        $(document).ready(function () {
            $.ajax({
                type: 'Get',
                dataType: 'JSON',
                url: 'https://balham-college-db.herokuapp.com/api/Lecturer/',
                success: function (data) {
                    // location.reload();

                    var i = 0;
                    while (i < data.length) {
                        lecturer = data[i];
                        $("#lecturer_id_input").append("<option value='" + lecturer.lecturerID + "'>" + lecturer.LastName + " " + lecturer.FirstName + "\</option>");
                        i = i + 1;
                    }
                    $("#lecturer_id_input").change(function(){
                        lecturer = getLecturerInfo($("#lecturer_id_input").val());
                        $("#lastname_input").val(lecturer.LastName);
                        $("#firstname_input").val(lecturer.FirstName);
                        $("#hourlyrate_input").val(lecturer.HourlyRate);
                        assignedCourses = getAssignedCourses($("#lecturer_id_input").val())
                        allCourses = getAllCourses();
                        console.log(assignedCourses);
                        console.log(allCourses);
                        var i = 0;
                        while (i < assignedCourses.length){
                            const index = allCourses.indexOf(assignedCourses[i]);
                            if (index > -1) {
                                allCourses.splice(index, 1);
                            }
                            i++;
                        }
                        console.log(allCourses);
                        var i = 0;
                        while (i < allCourses.length) {
                            courseID= allCourses[i];
                            course1 = getCourse(courseID);
                            console.log(course1);
                            $("#course_id_input").append("<option value='" + courses.CourseID + "'>" + courses.CourseName + "</option>");
                            i = i + 1;
                        }

                        //    put a valid case here

                    });


                },
                error: function (err) {
                    console.log(err);
                }
            });


            $("#assign_lecturer_but").click(function () {
                courseID=$("#course_id_input").val();
                // hours=$("#hours_input").val();
                LecturerID = $("#lecturer_id_input").val();
                $.ajax({
                    type: 'POST',
                    dataType: 'JSON',
                    url: 'https://balham-college-db.herokuapp.com/api/Lecturer/',
                    data: {
                        // hours: hours,
                        Lecturer: LecturerID,
                        Course: courseID
                    },
                    success: function (data) {
                        alert('Lecturer assigned successfully');
                        location.reload();
                    },
                    error: function (err) {
                        console.log(err);
                        errors = JSON.parse(err.responseText);
                        console.log(errors);

                    }
                });

            });
        });

        function getAssignedCourses(Lecturer) {
            courses = [];
            $.ajax({
                type: 'Get',
                dataType: 'JSON',
                url: 'https://balham-college-db.herokuapp.com/api/Course/',
                async: false,
                success: function (data) {
                    i = 0;
                    while (i < data.length) {
                        ass = data[i];
                        if (ass.Lecturer == Lecturer) {
                            courses.push(ass.Course);

                        }
                        i = i + 1;
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
            return courses;

        }

        function getAllCourses() {
            courses = [];
            $.ajax({
                type: 'Get',
                dataType: 'JSON',
                url: 'https://balham-college-db.herokuapp.com/api/Course/',
                async: false,
                success: function (data) {
                    i = 0;
                    while (i < data.length) {
                        course1 = data[i];

                        courses.push(course1.CourseID);


                        i = i + 1;
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
            return courses;

        }

        function getCourse(courseID) {
            $.ajax({
                type: 'Get',
                dataType: 'JSON',
                url: 'https://bigeye6.herokuapp.com/api/cases/'+courseID+'/',
                async: false,
                success: function (data) {

                    course1 = data;



                },
                error: function (err) {
                    console.log(err);
                }
            });
            return course1;

        }
    </script>
</head>
<body>
<div class="center">
    <h1>Assign an Lecturer</h1>
    <form onsubmit="return false">
        <p><label> Course : </label>
            <select id="course_id_input">
                <option value="">Select one</option>
            </select>
        </p>
        <p><label> Last Name: </label><input id="lastname_input" type="text" maxlength="25" size="25"></p>
        <p id = "lastname_input_err"></p>
        <p><label> First Name: </label><input id="firstname_input" type="text" maxlength="25" size="25"></p>
        <p id = "firstname_input_err"></p>
        <p><label> Hourly Rate: </label><input id="hourlyrate_input" type="number" maxlength="5" size="5"></p>
        <p id = "hourlyrate_input_err"></p>

        <p><label> Lecturer : </label>
            <select id="lecturer_id_input">
                <option value="">Select one</option>
            </select>

        </p>
        <p> <label>Case Date:</label><input id = "casedate_input" type = "date" maxlength="" size="10"></p>
        <p><label>Hours: </label><input id="hours_input" type="text" maxlength="3" size="3"></p>
        <p id="description_input_err"></p>


        <button type="button" id="assign_lecturer_but">Assign Investigator</button>
        <button type="button" ><a href="mainMenuBigEye.html"> Return</a></button>
        <p></p>
    </form>
</div>
</body>
</html>