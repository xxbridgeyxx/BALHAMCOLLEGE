<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Record Issue</title>
    <script
            src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous">
    </script>
    <script src="js/script.js"></script>
    <script>
        $(document).ready(function(){
            students = getAllStudents();
            var i = 0;
            while (i < students.length){
                student = students[i];
                $("#student_id_input").append("<option value='"+student.StudentID+"'>"+student.FirstName+" "+student.LastName+"</option>")
                i++;
            }

            $("#student_id_input").change(function (){
                studentID = $("#student_id_input").val();
                student = getStudent(studentID);
                $("#student_id").val(student.StudentID);
                $("#student_lastnamename").val(student.LastName);
                $("#student_firstname").val(student.FirstName);
                $("#student_streetaddy").val(student.StreetAddress);
                $("#student_suburb").val(student.Suburb);
                $("#student_city").val(student.City);


            });

            // function getEnrolementInfo(getEnrolement){
            //     $.ajax({
            //         type: 'Get',
            //         dataType: 'JSON',
            //         url: 'https://balham-college-db.herokuapp.com/api/Enrolement/' +getEnrolement + "/",
            //         success: function (data) {                     // location.reload();
            //             $("#enrolement_EnrolmentID").val(data.EnrolementID);
            //             $("#enrolement_Year").val(data.Year);
            //             $("#enrolement_Semester").val(data.Semester);
            //             $("#enrolement_CourseID").val(data.CourseID);
            //
            //         },
            //         error: function (err) {
            //             console.log(err);
            //         }
            //     });
            // }
            // function getStudentIssue(ID) {
            //     $.ajax({
            //         type: 'Get',
            //         dataType: 'JSON',
            //         url: 'https://bigeye4.herokuapp.com/api/payments/',
            //         success: function (data) {
            //             i = 0;
            //             $("#payments_list").html("");
            //
            //             while (i < data.length){
            //
            //                 payments = data[i];
            //                 if (payments.Student == ID){
            //                     $("#payments_report").append( "Payment ID: " + payments.PaymentID +"<br>" +" Payment Date: " + payments.PaymentDate +"<br>"+ " Amount: " + payments.Amount + "<hr>");
            //
            //                 }
            //                 i = i + 1;
            //             }
            //         },
            //         error: function (err) {
            //             console.log(err);
            //         }
            //     });
            // }

            $("#record_payment_but").click(function (){
                paymentInput = $("#payment_input").val();
                paymentDate = $("#payment_date_input").val();
                caseID = $("#cases_id_input").val();
                $.ajax({
                    type: 'POST',
                    dataType: 'JSON',
                    url: 'https://balham-college-db.herokuapp.com/api/Issue/',
                    data: {
                        IssueID: issueID, IssueDescription: issueDescription, IssueDate: IssueDate, ActionTaken: actionTaken,

                    }, success: function (data) {
                        alert('Payment Recorded successfully');
                        location.reload();
                    }, error: function (err) {
                        console.log(err);
                        errors = JSON.parse(err.responseText);
                        console.log(errors);
                        $("#payment_date_input_err").text(errors.PaymentDate);
                        $("#cases_id_input_err").text(errors.Case);
                        $("#payment_input_err").text(errors.Amount);

                    }
                });

            });
        });
    </script>
    <link rel="stylesheet" href="style.css">


</head>
<body>
<form onsubmit ="return false">
    <div id = "container">
        <div id = "volume">
            <h1>Record An Issue</h1>
            <hr>
            <p><label>Student: </label>
                <select id="student_id_input">
                    <option value = "">Select one</option>
                </select>
            </p>
            <p id="#student_id_input_err"></p>

            <p><label> Student ID: </label><input id="student_id" type="text" maxlength="5" size="5" disabled></p>
            <p><label> Student Last Name: </label><input id="student_lastnamename" type="text" maxlength="40" size="40" disabled></p>
            <p><label> Student First Name: </label><input id="student_firstname" type="text" maxlength="40" size="40" disabled></p>
            <p><label> Student Street Address: </label><input id="student_streetaddy"type="text" maxlength="40" size="40" disabled></p>
            <p><label> Suburb: </label><input id="student_suburb" type="text" maxlength="40" size="40" disabled></p>
            <p><label> City: </label><input id="student_city" type="text" maxlength="40" size="40" disabled></p>

            <hr>
            <p><label>Enrolement: </label>
                <select id="enrolement_id_input">
                    <option value = "">Select one</option>
                </select>
            </p>
            <p id="#enrolement_id_input_err"></p>
            <p><label> Enrolement Number: </label><input id="enrolement_number" type="text" maxlength="25" size="25" disabled></p>
            <p><label> Enrolment Year: </label><input id="enrolement_year" type="text" maxlength="25" size="25" disabled></p>
            <p><label> Enrolled Semester: </label><input id="enrolement_semester" type="text" maxlength="25" size="25" disabled></p>
            <p><label> Course Name: </label><input id="enrolement_coursename" type="text" maxlength="25" size="25" disabled></p>
            <hr>
            <label id="underlineHeading">List of Payments:</label>
            <p><label id = "payments_report" ></label></p>
            <p><label>Amount Paid: </label><input id="payment_input" type="number" maxlength="8" size="10"></p>
            <p id="payment_input_err"></p>

            <p><label>Payment Date: </label><input id="payment_date_input" type="date"></p>
            <p id="payment_date_input_err"></p>
            <hr>
            <div id = "buttonCase">

                <button type="button" id="record_issue_but">Record Issue</button>
                <a href="MainMenu.html"><button type="button" >Return</button></a>
            </div>
        </div>
    </div>
</form>
</body>
</html>